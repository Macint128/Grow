<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" /> 
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<title>Garden Life: Grow & Harvest</title>
<link rel="apple-touch-icon" href="icon.png" />
<meta name="apple-mobile-web-app-title" content="Garden Life" />
<style>
  *{margin:0; padding:0; box-sizing:border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;}
  body {
    background: linear-gradient(to bottom, #a8e6a2, #f4e2d8);
    height: 100vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  header {
    background: linear-gradient(to bottom, #5cb85c, #3e8e41);
    color: white;
    text-align: center;
    font-size: 1.3em;
    padding: 12px 0;
    position: fixed;
    width: 100%;
    top: 0;
    z-index: 100;
  }
  #infoBar {
    display: flex;
    justify-content: space-between;
    background: #fffdfa;
    padding: 8px 15px;
    box-shadow: 0 2px 6px rgb(0 0 0 / 0.15);
    font-weight: 600;
    font-size: 0.95em;
    position: fixed;
    top: 52px;
    width: 100%;
    z-index: 100;
  }
  #moneyDisplay, #weatherDisplay, #petsDisplay {
    min-width: 100px;
  }
  #garden {
    margin-top: 100px;
    flex-grow: 1;
    padding: 10px;
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    grid-gap: 7px;
    overflow-y: auto;
  }
  .tile {
    position: relative;
    background-color: #c19a6b;
    border-radius: 10px;
    aspect-ratio: 1/1;
    cursor: pointer;
    box-shadow: inset 0 2px 4px #7b573a;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    user-select: none;
    transition: transform 0.15s ease;
  }
  .tile:hover {
    transform: scale(1.05);
  }
  .plant {
    font-size: 2.5em;
    position: relative;
    bottom: 6px;
    animation: popGrow 0.5s ease forwards;
    user-select: none;
  }
  @keyframes popGrow {
    0% { transform: scale(0); opacity: 0; }
    70% { transform: scale(1.1); opacity: 1;}
    100% { transform: scale(1); }
  }
  /* ë“±ê¸‰ë³„ ìƒ‰ìƒ í…ìŠ¤íŠ¸ */
  .Common { color: gray; }
  .Uncommon { color: green; }
  .Rare { color: blue; }
  .Legendary { color: orange; }
  .Mythical { color: purple; }
  .Divine { color: gold; }
  .Prismatic { 
    background: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet); 
    -webkit-background-clip: text; color: transparent; font-weight: bold; 
  }
  #seedBox {
    background: #fffdfa;
    border-top: 2px solid #b1a27c;
    padding: 12px;
    font-size: 1.1em;
    text-align: center;
    font-weight: 700;
    user-select: none;
  }
  #seedBox .no-stock {
    color: red;
    font-weight: 900;
  }
  /* ë„ê° */
  #pokedex {
    position: fixed;
    top: 90px;
    right: 10px;
    max-height: 220px;
    overflow-y: auto;
    background: #fffdfa;
    border-radius: 8px;
    box-shadow: 1px 1px 8px rgba(0,0,0,0.2);
    padding: 8px 15px;
    width: 180px;
    font-size: 0.9em;
    z-index: 110;
  }
  #pokedex h3 {
    text-align: center;
    margin-bottom: 8px;
  }
  #pokedex ul {
    list-style: none;
    padding-left: 10px;
  }
  #pokedex li {
    margin-bottom: 4px;
  }
  /* ì¦ê²¨ì°¾ê¸° í‘œì‹œ */
  .favorited {
    box-shadow: 0 0 10px 3px gold inset;
    border-radius: 10px;
  }
  /* ì„±ì¥ ì¤‘ì¸ ì‘ë¬¼ íë¦¿ */
  .growing {
    filter: brightness(0.7);
    cursor: wait;
  }
  /* ëŒì—°ë³€ì´ íš¨ê³¼ (ë°˜ì§ì„) */
  .mutated {
    animation: flicker 1.5s infinite;
    filter: drop-shadow(0 0 5px magenta);
  }
  @keyframes flicker {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }
  /* í« í‘œì‹œ */
  #petArea {
    position: fixed;
    bottom: 70px;
    left: 10px;
    background: #fffdfa;
    border-radius: 10px;
    box-shadow: 1px 1px 6px rgba(0,0,0,0.2);
    padding: 10px 15px;
    font-size: 1em;
    max-width: 300px;
    z-index: 120;
  }
  #petArea span {
    margin-right: 12px;
    cursor: default;
  }
  /* ì¥ë¹„ í‘œì‹œ */
  #gearArea {
    position: fixed;
    bottom: 70px;
    right: 10px;
    background: #fffdfa;
    border-radius: 10px;
    box-shadow: 1px 1px 6px rgba(0,0,0,0.2);
    padding: 10px 15px;
    font-size: 1em;
    max-width: 300px;
    z-index: 120;
  }
  /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
  button {
    cursor: pointer;
    border-radius: 5px;
    border: none;
    background: #5cb85c;
    color: white;
    font-weight: 600;
    padding: 6px 12px;
    margin-left: 8px;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #4a9e4a;
  }
  /* ì„ í˜¸ í‘œì‹œ í† ê¸€ ë²„íŠ¼ */
  .favorite-btn {
    position: absolute;
    top: 4px;
    right: 4px;
    background: rgba(255 215 0 / 0.9);
    border-radius: 50%;
    width: 24px;
    height: 24px;
    font-weight: bold;
    color: #444;
    text-align: center;
    line-height: 24px;
    user-select: none;
    cursor: pointer;
    box-shadow: 0 0 6px 2px gold;
  }
  .favorite-btn.favorited {
    color: #ff6600;
    box-shadow: 0 0 10px 3px orange;
  }
</style>
</head>
<body>

<header>ğŸŒ¿ Garden Life: Grow & Harvest</header>

<div id="infoBar">
  <div id="moneyDisplay">ğŸ’° 0Â¢</div>
  <div id="weatherDisplay">ğŸŒ¤ Weather: Clear</div>
  <div id="petsDisplay">ğŸ¾ Pets: None</div>
</div>

<div id="garden"></div>

<div id="seedBox">Current Seed: <span id="seedName">Loading...</span></div>

<div id="pokedex">
  <h3>ğŸ“˜ Seed Pokedex</h3>
  <ul id="dexList"></ul>
</div>

<div id="petArea">
  <strong>ğŸ¾ Pets Owned:</strong> <span id="petList">None</span>
</div>

<div id="gearArea">
  <strong>ğŸ› ï¸ Gear:</strong> <span id="gearList">None</span>
</div>

<script>
(() => {
  // ê²Œì„ ë°ì´í„° & ìƒíƒœ
  const seeds = [
    {name:'Carrot',emoji:'ğŸ¥•',grade:'Common',growTime:20, value:1},
    {name:'Strawberry',emoji:'ğŸ“',grade:'Common',growTime:22, value:1},
    {name:'Blueberry',emoji:'ğŸ«',grade:'Uncommon',growTime:30, value:2},
    {name:'Orange Tulip',emoji:'ğŸŒ·',grade:'Uncommon',growTime:28, value:2},
    {name:'Tomato',emoji:'ğŸ…',grade:'Rare',growTime:45, value:4},
    {name:'Daffodil',emoji:'ğŸŒ¼',grade:'Rare',growTime:40, value:4},
    {name:'Watermelon',emoji:'ğŸ‰',grade:'Legendary',growTime:90, value:7},
    {name:'Pumpkin',emoji:'ğŸƒ',grade:'Legendary',growTime:85, value:7},
    {name:'Apple',emoji:'ğŸ',grade:'Legendary',growTime:80, value:7},
    {name:'Bamboo',emoji:'ğŸ‹',grade:'Legendary',growTime:70, value:7},
    {name:'Coconut',emoji:'ğŸ¥¥',grade:'Mythical',growTime:120, value:10},
    {name:'Cactus',emoji:'ğŸŒµ',grade:'Mythical',growTime:110, value:10},
    {name:'Dragon Fruit',emoji:'ğŸ‰',grade:'Mythical',growTime:130, value:10},
    {name:'Mango',emoji:'ğŸ¥­',grade:'Mythical',growTime:115, value:10},
    {name:'Grape',emoji:'ğŸ‡',grade:'Divine',growTime:150, value:15},
    {name:'Mushroom',emoji:'ğŸ„',grade:'Divine',growTime:140, value:15},
    {name:'Pepper',emoji:'ğŸŒ¶ï¸',grade:'Divine',growTime:145, value:15},
    {name:'Cacao',emoji:'ğŸ«',grade:'Divine',growTime:135, value:15},
    {name:'Beanstalk',emoji:'ğŸŒ±',grade:'Prismatic',growTime:200, value:25},
    {name:'Ember Lily',emoji:'ğŸ”¥',grade:'Prismatic',growTime:190, value:25},
    {name:'Sugar Apple',emoji:'ğŸ',grade:'Prismatic',growTime:195, value:25},
    {name:'Burning Bud',emoji:'ğŸŒ¸',grade:'Prismatic',growTime:185, value:25},
    {name:'Giant Pinecone',emoji:'ğŸŒ²',grade:'Prismatic',growTime:210, value:25},
  ];
  const pets = [
    {name:'Moon Cat',emoji:'ğŸ±',rarity:'Rare',autoHarvest:true},
    {name:'Deer',emoji:'ğŸ¦Œ',rarity:'Uncommon',autoHarvest:true},
    {name:'Axolotl',emoji:'ğŸ¦',rarity:'Mythical',autoHarvest:true},
    {name:'Petal Bee',emoji:'ğŸ',rarity:'Legendary',autoHarvest:true},
    {name:'Stegosaurus',emoji:'ğŸ¦–',rarity:'Divine',autoHarvest:true}
  ];
  const gears = [
    {name:'Basic Sprinkler',effect:'growthBoost',value:0.1,rarity:'Common'},
    {name:'Advanced Sprinkler',effect:'growthBoost',value:0.25,rarity:'Rare'},
    {name:'Godly Sprinkler',effect:'growthBoost',value:0.5,rarity:'Mythical'},
    {name:'Master Sprinkler',effect:'growthBoost',value:0.9,rarity:'Prismatic'}
  ];

  const gardenSize = 25; // 5x5 grid
  let currentSeed = null;
  let money = 10; // ì´ˆê¸° ëˆ
  let pokedex = new Set();
  let petsOwned = new Set();
  let gearsOwned = new Set();

  let weather = {
    type: 'Clear', // Clear, Rain, MutationStorm
    mutationActive: false,
    mutationBonus: 1,
    changeTime: Date.now() + 5*60*1000
  };

  const growthIntervals = [];
  const plantStates = []; // ìƒíƒœ ë°°ì—´ (null or {seed, plantedTime, growTimeLeft, mutated, favorited})

  const gardenElem = document.getElementById('garden');
  const moneyDisplay = document.getElementById('moneyDisplay');
  const seedNameSpan = document.getElementById('seedName');
  const dexList = document.getElementById('dexList');
  const weatherDisplay = document.getElementById('weatherDisplay');
  const petsDisplay = document.getElementById('petsDisplay');
  const petList = document.getElementById('petList');
  const gearList = document.getElementById('gearList');

  // ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
  function saveGame(){
    const saveData = {
      money,
      pokedex: Array.from(pokedex),
      petsOwned: Array.from(petsOwned),
      gearsOwned: Array.from(gearsOwned),
      plantStates,
      weather,
      lastSave: Date.now()
    };
    localStorage.setItem('gardenSave', JSON.stringify(saveData));
  }
  function loadGame(){
    const saveData = JSON.parse(localStorage.getItem('gardenSave') || '{}');
    if(saveData.money) money = saveData.money;
    if(saveData.pokedex) pokedex = new Set(saveData.pokedex);
    if(saveData.petsOwned) petsOwned = new Set(saveData.petsOwned);
    if(saveData.gearsOwned) gearsOwned = new Set(saveData.gearsOwned);
    if(saveData.plantStates) {
      for(let i=0; i < gardenSize; i++) {
        plantStates[i] = saveData.plantStates[i] || null;
      }
    } else {
      for(let i=0; i < gardenSize; i++) plantStates[i] = null;
    }
    if(saveData.weather) weather = saveData.weather;
  }

  // ë„ê° ì—…ë°ì´íŠ¸
  function updatePokedex(seedName) {
    if(!pokedex.has(seedName)){
      pokedex.add(seedName);
      const li = document.createElement('li');
      li.textContent = seedName;
      dexList.appendChild(li);
    }
  }

  // ì”¨ì•— ëœë¤ ì„ íƒ(5ë¶„ë§ˆë‹¤ ë¦¬ì…‹)
  function pickRandomSeed() {
    const chance = Math.random();
    if(chance < 0.15){
      currentSeed = null;
      seedNameSpan.innerHTML = '<span class="no-stock">No Stock</span>';
    } else {
      currentSeed = seeds[Math.floor(Math.random() * seeds.length)];
      seedNameSpan.innerHTML = `<span class="${currentSeed.grade}">${currentSeed.emoji} ${currentSeed.name} [${currentSeed.grade}]</span>`;
    }
  }

  // ì„±ì¥ì‹œê°„ ë³´ì •(ì¥ë¹„ íš¨ê³¼ ë°˜ì˜)
  function getGrowthTime(seed){
    let base = seed.growTime;
    let boost = 0;
    gearsOwned.forEach(g => {
      const gear = gears.find(x => x.name === g);
      if(gear && gear.effect === 'growthBoost') boost += gear.value;
    });
    // ì„±ì¥ì‹œê°„ 1 - boost ë§Œí¼ ë‹¨ì¶• (ìµœì†Œ 20% ë‚¨ê¹€)
    const finalTime = base * Math.max(0.2, 1 - boost);
    return finalTime;
  }

  // ëˆ ì˜¬ë¦¬ëŠ” ë³´ì • (ë‚ ì”¨ ëŒì—°ë³€ì´ ë³´ì • + ì¥ë¹„)
  function getValue(seed){
    let val = seed.value;
    if(weather.mutationActive) val *= 2; // ëŒì—°ë³€ì´ ì‹œ 2ë°° ìˆ˜ìµ
    gearsOwned.forEach(g => {
      const gear = gears.find(x => x.name === g);
      if(gear && gear.effect === 'valueBoost') val += gear.value;
    });
    return val;
  }

  // ì„±ì¥ ì²˜ë¦¬ ë° UIì—…ë°ì´íŠ¸
  function updateGardenUI(){
    gardenElem.innerHTML = '';
    for(let i=0; i < gardenSize; i++){
      const tile = document.createElement('div');
      tile.className = 'tile';
      const plant = plantStates[i];
      if(plant){
        const p = document.createElement('div');
        p.className = `plant ${plant.seed.grade}`;
        p.textContent = plant.seed.emoji;
        if(plant.mutated) p.classList.add('mutated');
        if(plant.favorited) tile.classList.add('favorited');
        else tile.classList.remove('favorited');
        if(plant.growTimeLeft > 0) {
          tile.classList.add('growing');
          const remainSec = Math.ceil(plant.growTimeLeft);
          p.title = `${plant.seed.name} (Growing: ${remainSec}s)`;
        } else {
          p.title = `${plant.seed.name} (Ready!)`;
        }
        tile.appendChild(p);
      }
      // ì¦ê²¨ì°¾ê¸° í† ê¸€ ë²„íŠ¼
      const favBtn = document.createElement('div');
      favBtn.className = 'favorite-btn' + (plant && plant.favorited ? ' favorited' : '');
      favBtn.textContent = 'â˜…';
      favBtn.title = 'Toggle Favorite';
      favBtn.addEventListener('click', e => {
        e.stopPropagation();
        if(!plant) return;
        plant.favorited = !plant.favorited;
        updateGardenUI();
        saveGame();
      });
      tile.appendChild(favBtn);

      // í´ë¦­ ì´ë²¤íŠ¸ (ì‹¬ê¸°, ìˆ˜í™•, í« ìë™ìˆ˜í™•)
      tile.addEventListener('click', () => {
        const plant = plantStates[i];
        if(!currentSeed && !plant) return; // ì‹¬ì„ ì”¨ì•— ì—†ìœ¼ë©´ íŒ¨ìŠ¤

        if(plant && plant.growTimeLeft <= 0) {
          // ìˆ˜í™• ê°€ëŠ¥
          money += getValue(plant.seed);
          updateMoneyDisplay();
          updatePokedex(plant.seed.name);
          // ìˆ˜í™• í›„ ì¬ì‹¬ê¸° or ì œê±°
          if(petsOwned.size > 0 && Array.from(petsOwned).some(pet => pets.find(x => x.name === pet).autoHarvest)) {
            // ìë™ ì¬ì‹¬ê¸° (í« ìˆìŒ)
            plant.growTimeLeft = getGrowthTime(plant.seed);
            plant.plantedTime = Date.now()/1000;
            plant.mutated = false;
          } else {
            plantStates[i] = null;
          }
          updateGardenUI();
          saveGame();
        } else if(!plant && currentSeed) {
          // ì‹¬ê¸°
          plantStates[i] = {
            seed: currentSeed,
            plantedTime: Date.now()/1000,
            growTimeLeft: getGrowthTime(currentSeed),
            mutated: false,
            favorited: false
          };
          updateGardenUI();
          saveGame();
        }
      });

      gardenElem.appendChild(tile);
    }
  }

  // ëˆ í‘œì‹œ ì—…ë°ì´íŠ¸
  function updateMoneyDisplay(){
    moneyDisplay.textContent = `ğŸ’° ${money.toFixed(0)}Â¢`;
  }

  // í« UI ì—…ë°ì´íŠ¸
  function updatePetUI(){
    if(petsOwned.size === 0){
      petsDisplay.textContent = 'ğŸ¾ Pets: None';
      petList.textContent = 'None';
      return;
    }
    const petNames = Array.from(petsOwned).map(p => {
      const pet = pets.find(x => x.name === p);
      return pet ? `${pet.emoji} ${pet.name}` : p;
    });
    petsDisplay.textContent = `ğŸ¾ Pets: ${petNames.join(', ')}`;
    petList.textContent = petNames.join(', ');
  }

  // ì¥ë¹„ UI ì—…ë°ì´íŠ¸
  function updateGearUI(){
    if(gearsOwned.size === 0){
      gearList.textContent = 'None';
      return;
    }
    const gearNames = Array.from(gearsOwned).map(g => {
      const gear = gears.find(x => x.name === g);
      return gear ? gear.name : g;
    });
    gearList.textContent = gearNames.join(', ');
  }

  // ì„±ì¥ íƒ€ì´ë¨¸ (1ì´ˆë§ˆë‹¤ ê°±ì‹ )
  function tickGrowth(deltaSec){
    for(let i=0; i < gardenSize; i++){
      const plant = plantStates[i];
      if(plant && plant.growTimeLeft > 0){
        plant.growTimeLeft -= deltaSec;
        if(plant.growTimeLeft <= 0){
          plant.growTimeLeft = 0;
          // ëŒì—°ë³€ì´ ì¡°ê±´ íŒë‹¨
          if(weather.type === 'MutationStorm' && Math.random() < 0.4) {
            plant.mutated = true;
          }
        }
      }
    }
  }

  // ë‚ ì”¨ ë³€ê²½ (5ë¶„ë§ˆë‹¤)
  function updateWeather(){
    const now = Date.now();
    if(now > weather.changeTime){
      // ìƒˆ ë‚ ì”¨ ëœë¤ ìƒì„±
      const roll = Math.random();
      if(roll < 0.6) {
        weather.type = 'Clear';
        weather.mutationActive = false;
        weather.mutationBonus = 1;
      } else if(roll < 0.9) {
        weather.type = 'Rain';
        weather.mutationActive = false;
        weather.mutationBonus = 1;
      } else {
        weather.type = 'MutationStorm';
        weather.mutationActive = true;
        weather.mutationBonus = 2;
      }
      weather.changeTime = now + 5*60*1000;
    }
    weatherDisplay.textContent = `ğŸŒ¤ Weather: ${weather.type}`;
  }

  // ì˜¤í”„ë¼ì¸ ì„±ì¥ (ë§ˆì§€ë§‰ ì €ì¥ ì´í›„ ê²½ê³¼ ì‹œê°„ ê³„ì‚°)
  function offlineGrowth(){
    const saveData = JSON.parse(localStorage.getItem('gardenSave') || '{}');
    if(!saveData.lastSave) return;
    const elapsed = (Date.now() - saveData.lastSave) / 1000; // ì´ˆ
    if(elapsed < 1) return;
    tickGrowth(elapsed);
  }

  // ì”¨ì•— ìƒì  ë³€ê²½ (5ë¶„ë§ˆë‹¤)
  function shopTick(){
    pickRandomSeed();
  }

  // ì‹œì‘
  function startGame(){
    loadGame();
    offlineGrowth();
    updateMoneyDisplay();
    updatePetUI();
    updateGearUI();
    updateWeather();
    updateGardenUI();
    shopTick();
    // íƒ€ì´ë¨¸ ì„¤ì •
    let lastTime = Date.now();
    setInterval(() => {
      const now = Date.now();
      const delta = (now - lastTime)/1000;
      lastTime = now;
      tickGrowth(delta);
      updateGardenUI();
      updateWeather();
      saveGame();
    }, 1000);
    // ì”¨ì•— ìƒì  ë³€ê²½ íƒ€ì´ë¨¸
    setInterval(shopTick, 5*60*1000);
  }

  // í…ŒìŠ¤íŠ¸ìš© í«, ì¥ë¹„ ì¶”ê°€ (ì´ˆê¸° ë³´ìœ )
  petsOwned.add('Moon Cat');
  gearsOwned.add('Basic Sprinkler');

  startGame();

})();
</script>

</body>
</html>
